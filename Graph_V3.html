<html>
    <style>
      #chartdiv {
        width: 100%;
        height: 500px;
      }
      /* Style the form */
        form {
            border: 3px solid #f1f1f1;
            width: 40%;
            margin: 0 auto;
            padding: 10px;
            background-color: #f1f1f1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        /* Style the input fields in center of form */
      input[type="text"],
      select,
      input[type="submit"] {
        padding: 10px;
        border: none;
        border-radius: 5px;
        margin: 5px;
        font-size: 1em;
        font-family: Arial, Helvetica, sans-serif;
        box-shadow: 0px 0px 5px #ccc;
      }
      input[type="submit"] {
        background-color: #0022ff;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      input[type="submit"]:hover {
        background-color: #148f77;
      }
      h1 {text-align: center;}
    </style>
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
<h1 style="font-family:verdana;">Scheduling Algorithm Calculator</h1>

<div id="chartdiv"></div>
<body>

      <script>
            // Create root element
          // https://www.amcharts.com/docs/v5/getting-started/#Root_element
          var root = am5.Root.new("chartdiv");

          // Set themes
          // https://www.amcharts.com/docs/v5/concepts/themes/
          root.setThemes([
            am5themes_Animated.new(root)
          ]);


          // Create chart
          // https://www.amcharts.com/docs/v5/charts/xy-chart/
          var chart = root.container.children.push(am5xy.XYChart.new(root, {
            panX: false,
            panY: false,
            wheelX: "panX",
            wheelY: "zoomX",
            layout: root.verticalLayout
          }));

          // Add legend
          // https://www.amcharts.com/docs/v5/charts/xy-chart/legend-xy-series/
          var legend = chart.children.push(am5.Legend.new(root, {
            centerX: am5.p50,
            x: am5.p50
          }));

          //create color set
          var colors = chart.get("colors");

          // get data from python
          values = {{ data|safe }}
          var data = []

          //make data for chart
          for(var i = 0; i < values.length; i++){
              for (var j = 0; j < values[i].length; j++){
                  data.push({
                      category: "Task "+(i+1),
                      fromValue: values[i][j][0],
                      toValue: values[i][j][1],
                      columnSettings: {
                          fill: am5.Color.brighten(colors.getIndex(i), 0.1 * i)
                      }
                  })
                  console.log(values[i][j][0])
              }
          }

          //make labels
          var labels = []
          for(var i = 0; i < values.length; i++){
              labels.push({
                  category: "Task "+(i+1)
              })
          }

          // Create axes
          // https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
          var yAxis = chart.yAxes.push(
            am5xy.CategoryAxis.new(root, {
              categoryField: "category",
              renderer: am5xy.AxisRendererY.new(root, {
                inversed: true
              }),
              tooltip: am5.Tooltip.new(root, {
                themeTags: ["axis"],
                animationDuration: 1000
              })
            })
          );


          //set the y axis to the task labels 
          yAxis.data.setAll(labels);


          var xAxis = chart.xAxes.push(
            am5xy.ValueAxis.new(root, {
              renderer: am5xy.AxisRendererX.new(root, {
                strokeOpacity: 0.1
              })
            })
          );

          // Add series
          // https://www.amcharts.com/docs/v5/charts/xy-chart/series/
          var series = chart.series.push(am5xy.ColumnSeries.new(root, {
            xAxis: xAxis,
            yAxis: yAxis,
            openValueXField: "fromValue",
            valueXField: "toValue",
            categoryYField: "category",
            sequencedInterpolation: true
          }));

          series.columns.template.setAll({
            templateField: "columnSettings",
            strokeOpacity: 0,
            tooltipText: "{category}: {openValueX} - {valueX}"
          });

          series.data.setAll(data);


          // Add scrollbars
          chart.set("scrollbarX", am5.Scrollbar.new(root, {
            orientation: "horizontal"
          }));

          // Make stuff animate on load
          // https://www.amcharts.com/docs/v5/concepts/animations/
          series.appear();
          chart.appear(1000, 100);
      </script>
</body>

<div id="input"></div>
<form method="POST" action="/" onsubmit="return validateForm()">
  <h2 style="font-family:verdana;">Enter tasks (comma-separated integers)</h2>
  <div style="display:flex;">
    <div style="flex:1;">
      <input type="text" name="arrival_times" required placeholder="Arrival Times" pattern="^([0-9]*)+(,[0-9]+)+$"><br><br>
      <input type="text" name="execution_times" required placeholder="Execution times" pattern="^([0-9]*)+(,[0-9]+)+$"><br><br>
      <input type="text" name="runtime" required placeholder="Runtime" pattern="^\d+$"><br><br>
    </div>
    <div style="flex:1;">
      <select name="algorithm" onchange="showInputs()">
        <option value="fcfs">First-Come-First-Serve</option>
        <option value="rr">Round Robin</option>
        <option value="fcfs-p">First-Come-First-Serve (Periodic Tasks)</option>
      </select>
      <br><br>
      <div id="period-div" style="display:none">
        <input type="text" name="period" id="period-input" placeholder="Period (Periodic FCFS)" pattern="^([0-9]*)+(,[0-9]+)+$"><br><br>
      </div>
      <div id="quantum-div" style="display:none">
        <input type="text" name="quantum" id="quantum-input" placeholder="Quantum (Round Robin)" pattern="^\d+$"><br><br>
      </div>
    </div>
  </div>
  <input type="submit" value="Schedule">
</form>

<script>
function validateForm() {
  let arrival_times_input = document.getElementsByName("arrival_times")[0];
  let execution_times_input = document.getElementsByName("execution_times")[0];
  let runtime_input = document.getElementsByName("runtime")[0];

  let is_valid = true;

  if (!arrival_times_input.checkValidity()) {
    arrival_times_input.setCustomValidity("Enter Arrival Times");
    is_valid = false;
  }

  if (!execution_times_input.checkValidity()) {
    execution_times_input.setCustomValidity("Enter Execution Times");
    is_valid = false;
  }

  if (!runtime_input.checkValidity()) {
    runtime_input.setCustomValidity("Enter Runtime");
    is_valid = false;
  }

  return is_valid;
}
</script>

<script>
function showInputs() {
  var algorithm = document.getElementsByName("algorithm")[0].value;
  var periodDiv = document.getElementById("period-div");
  var quantumDiv = document.getElementById("quantum-div");
  if (algorithm === "fcfs-p") {
    periodDiv.style.display = "block";
    quantumDiv.style.display = "none";
  } else if (algorithm === "rr") {
    periodDiv.style.display = "none";
    quantumDiv.style.display = "block";
  } else {
    periodDiv.style.display = "none";
    quantumDiv.style.display = "none";
  }
}
</script>


</html>